<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>RHEL on itchronicles</title>
    <link>http://localhost:1313/categories/rhel/</link>
    <description>Recent content in RHEL on itchronicles</description>
    <generator>Hugo</generator>
    <language>en-us</language>
    <lastBuildDate>Thu, 26 Dec 2024 17:58:53 +0100</lastBuildDate>
    <atom:link href="http://localhost:1313/categories/rhel/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Automating Disk Resizing with Ansible on RHEL Server</title>
      <link>http://localhost:1313/automating-disk-resizing/</link>
      <pubDate>Thu, 26 Dec 2024 17:58:53 +0100</pubDate>
      <guid>http://localhost:1313/automating-disk-resizing/</guid>
      <description>&lt;p&gt;As server admins, resizing disks of virtual machines is a task that routinely happens. It often involves several manual steps, from rescanning the SCSI bus to resizing physical and logical volumes. However, these steps can be automated using Ansible, making the process more efficient and less error-prone.&lt;/p&gt;&#xA;&lt;p&gt;This playbook assumes that the physical root disk has been resized for more storage and provides a solution using Ansible.&lt;/p&gt;&#xA;&lt;h2 id=&#34;ansible-playbook-for-disk-resizing&#34;&gt;Ansible Playbook for Disk Resizing:&lt;/h2&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-YAML&#34; data-lang=&#34;YAML&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;---&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;- &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;Automate Disk Resizing on RHEL&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;hosts&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;all&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;become&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;yes&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;tasks&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    - &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;Rescan SCSI bus&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;ansible.builtin.shell&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;rescan-scsi-bus.sh -u&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    - &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;Resize partition 2 on /dev/sda&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;ansible.builtin.expect&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;command&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;parted ---pretend-input-tty /dev/sda resizepart&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;responses&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Fix/Ignore?&amp;#34;: &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Fix&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Partition number?&amp;#34;: &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;2&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;End?&amp;#34;: &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;100%&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    - &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;Inform the OS of partition table changes&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;ansible.builtin.shell&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;partprobe /dev/sda&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    - &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;Resize physical volume /dev/sda2&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;ansible.builtin.shell&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;pvresize /dev/sda2&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    - &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;Extend logical volume /dev/mapper/rhel-root&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;ansible.builtin.shell&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;lvextend -r -l +100%FREE /dev/mapper/rhel-root&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    - &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;Rescan SCSI bus&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;ansible.builtin.shell&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;rescan-scsi-bus.sh -u&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;this-playbook-performs-the-following-tasks&#34;&gt;This playbook performs the following tasks:&lt;/h2&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;Rescans the SCSI bus to detect the new disk size.&lt;/li&gt;&#xA;&lt;li&gt;Uses &lt;code&gt;parted&lt;/code&gt; to resize the partition. The &lt;code&gt;expect&lt;/code&gt; module helps handle interactive prompts by providing the necessary responses.&lt;/li&gt;&#xA;&lt;li&gt;Runs &lt;code&gt;partprobe&lt;/code&gt; to inform the operating system of partition table changes.&lt;/li&gt;&#xA;&lt;li&gt;Resizes the physical volume using &lt;code&gt;pvresize&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;li&gt;Extends the logical volume using &lt;code&gt;lvextend&lt;/code&gt; to utilize the newly available space.&lt;/li&gt;&#xA;&lt;li&gt;Rescans the SCSI bus again as a final step.&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;This playbook is designed for a RHEL server in a home lab environment, where automatic provisioning was used. However, in a production setting, it is more common to manually size the partitions in a template, which makes it possible to use the playbook for different hosts. If the volume is under another number or the logical volume has another name, the script needs to be edited accordingly.&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
